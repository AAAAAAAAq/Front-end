<!-- Othello 过程式代码-->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="author" content="大亮"/>
        <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
        <title>Othello</title>
    </head>
    <body>
        <div id="board"></div>
        <script>
            let board = [
                [1, 1, 1, 1, 1, 1, 1, 0],
                [1, 2, 2, 2, 2, 2, 2, 2],
                [1, 2, 1, 1, 1, 1, 2, 2],
                [1, 1, 1, 2, 1, 2, 1, 2],
                [1, 1, 1, 1, 2, 1, 2, 2],
                [1, 1, 2, 2, 2, 1, 2, 0],
                [1, 1, 1, 1, 1, 2, 2, 2],
                [2, 2, 2, 2, 2, 2, 2, 2],
            ];
            let color = 1;
            let container = document.getElementById('board');
            render();

            function move(x, y, checkOnly = false) {
                let ox = x, oy = y;
                let canMove = false;

                if (board[x][y] != 0) 
                    return false;

                let directions = [
                    [-1, -1],//左上
                    [-1,  0],//左
                    [-1,  1],//左下
                    [ 0,  1],//下
                    [ 0, -1],//上
                    [ 1,  1],//右下
                    [ 1, -1],//右上
                    [ 1,  0],//右
                ];

                for (let direction of directions) {
                    let directionCanMove = false;
                    let hasOpposite = false;

                    x = ox;
                    y = oy;

                    while(true) { 
                        x += direction[0];
                        y += direction[1];
                        if (x < 0 || x >= 8 || y < 0 || y >= 8) //判断越界
                            break;

                        if (board[x][y] == 3 - color) { //遇到不同色
                            hasOpposite = true;
                        }
                        if (board[x][y] == color) { //遇到同色
                            if (hasOpposite) 
                                directionCanMove = true;
                            break;
                        }
                        if (board[x][y] == 0) { //遇到边界
                            break;
                        }
                    }
                    if (directionCanMove && !checkOnly) {
                        while(true) { //吃子
                            x -= direction[0];
                            y -= direction[1];
                            if (x == ox && y == oy) {
                                break;
                            }
                            board[x][y] = color;
                        }
                    }
                    // console.log(directionCanMove);
                    canMove = canMove || directionCanMove;
                }   

                if (canMove && !checkOnly) {
                    board[ox][oy] = color;
                    color = 3 - color;
                    console.log("next color: ", color === 1 ? "black" : "white");
                }
                return canMove;
            }

            function checkPass() {
                for(let x = 0; x < 8; x++) {
                    for (let y = 0; y < 8; y++) {
                        if (move(x, y, true)) {
                            return false;
                        }
                    }
                }
                return true;
            }
      
            function render() {
                container.innerHTML = "";
                for (let x = 0; x < 8; x++) {
                    for (let y = 0; y < 8; y++) {
                        let element = document.createElement('div');
                        element.style = "border:solid 1px white;width:50px;height:50px;background-color:darkgreen;display:inline-block;vertical-align:bottom";
                        element.addEventListener('click', (event) => {
                                // console.log(x, y);
                                move(x, y);
                                if (checkPass()) {
                                    console.log("passed");
                                    color = 3 - color;
                                    if (checkPass()) {
                                        let temp = board.flat();
                                        console.log(temp);
                                        let blackCount = temp.filter(a => a == 1).length;
                                        let whiteCount = temp.filter(a => a == 2).length;
                                        alert(`game over, black:${blackCount}, white:${whiteCount}, ${blackCount > whiteCount ? "Black Win" : "White Win"}`);
                                    }
                                }
                                render();
                        });
                        container.appendChild(element);
                        if (board[x][y] == 1) {
                            let disc = document.createElement('div');
                            disc.style = "border-radius:20px;width:40px;height:40px;margin-top:5px;margin-left:5px;background-color:black;";
                            element.appendChild(disc);
                        } else if (board[x][y] == 2) {
                            let disc = document.createElement('div');
                            disc.style = "border-radius:20px;width:40px;height:40px;margin-top:5px;margin-left:5px;background-color:white;";
                            element.appendChild(disc);
                        } 
                    }
                    container.appendChild(document.createElement("br"));
                }
            }
        
        </script>
    </body>
</html>